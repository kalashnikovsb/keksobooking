(()=>{"use strict";let e=[];const t=document.querySelector("#success").content.querySelector(".success"),r=document.querySelector("#error").content.querySelector(".error"),o=document.querySelector("body"),a=()=>{o.appendChild(r)},n=()=>{t.remove(),r.remove()};window.addEventListener("keydown",(e=>{"Escape"===e.code&&n()})),window.addEventListener("click",(()=>{n()})),t.style.zIndex=1e3,r.style.zIndex=1e3;const s=document.querySelector(".ad-form"),i=document.querySelector(".ad-form__reset"),c=s.querySelector("#title"),l=s.querySelector("#price"),d=s.querySelector("#type"),u=s.querySelector("#timein"),p=s.querySelector("#timeout"),m=s.querySelector("#address"),y=s.querySelector("#room_number"),f=s.querySelector("#capacity"),h=s.querySelector("#avatar"),g=s.querySelector(".ad-form-header__preview > img"),v=s.querySelector("#images"),w=s.querySelector(".ad-form__photo"),L=["gif","jpg","jpeg","png"],S={bungalow:0,flat:1e3,hotel:3e3,house:5e3,palace:1e4},q=()=>{const e=S[d.value],t=l.value;l.placeholder=e,l.min=e,t<e||t<0?l.setCustomValidity(`Цена не может быть ниже ${e}`):t>1e6?l.setCustomValidity("Цена не может быть выше 1000000"):l.setCustomValidity(""),l.reportValidity()},_=e=>{("timein"===e.target.id?p:u).value=e.target.value},E=()=>{const e=+y.value,t=+f.value;if(100===e&&0===t)f.setCustomValidity("");else if(e>=t&&100!==e&&0!==t)f.setCustomValidity("");else switch(e){case 1:f.setCustomValidity("Количество комнат подходит только 1 гостю");break;case 2:f.setCustomValidity("Количество комнат подходит 1 или 2 гостям");break;case 3:f.setCustomValidity("Количество комнат подходит для 1, 2 или 3 гостей");break;case 100:f.setCustomValidity("Такое количество комнат не подходит для гостей")}f.reportValidity()},C=e=>{m.value=`${e.lat}, ${e.lng}`};c.addEventListener("input",(()=>{const e=c.value.length;e<30?c.setCustomValidity(`Заголовок объявления должен содержать минимум 30 символов. Добавьте ${30-c.value.length} символов`):e>1e3?c.setCustomValidity(`Заголовок объявления должен содержать максимум 1000 символов. Удалите ${c.value.length-1e3} символов`):c.setCustomValidity(""),c.reportValidity()})),d.addEventListener("change",q),l.addEventListener("input",q),u.addEventListener("change",_),p.addEventListener("change",_),y.addEventListener("change",E),f.addEventListener("change",E),s.addEventListener("submit",(e=>{var r,n,s;e.preventDefault(),r=()=>{z(),o.appendChild(t)},n=a,s=new FormData(e.target),fetch("https://23.javascript.pages.academy/keksobooking",{method:"POST",body:s}).then((e=>{if(!e.ok)throw Error();r()})).catch((()=>{n()}))})),i.addEventListener("click",(e=>{e.preventDefault(),z()})),h.addEventListener("change",(()=>{const e=h.files[0],t=e.name.toLowerCase();if(L.some((e=>t.endsWith(e)))){const t=new FileReader;t.addEventListener("load",(()=>{g.src=t.result})),t.readAsDataURL(e)}})),v.addEventListener("change",(()=>{const e=v.files[0],t=e.name.toLowerCase();if(L.some((e=>t.endsWith(e)))){const t=new FileReader;t.addEventListener("load",(()=>{const e=document.createElement("img");e.src=t.result,e.width=70,e.height=70,e.alt="Фотография жилья",w.appendChild(e)})),t.readAsDataURL(e)}}));const b=document.querySelector(".map__filters"),k=(e,t,r)=>{const{features:o}=e.offer;return!(!o&&t||t&&-1===o.indexOf(r))},x={type:"any",price:"any",rooms:"any",guests:"any",wifi:!1,dishwasher:!1,parking:!1,washer:!1,elevator:!1,conditioner:!1},V={type:(e,t)=>{const{type:r}=e.offer;return"any"===t||r===x.type},price:(e,t)=>{const{price:r}=e.offer;switch(t){case"any":return!0;case"low":return r<1e4;case"high":return r>5e4;default:return r>=1e4&&r<=5e4}},rooms:(e,t)=>{const{rooms:r}=e.offer;return"any"===t||r===+t},guests:(e,t)=>{const{guests:r}=e.offer;return"any"===t||r===+t},wifi:k,dishwasher:k,parking:k,washer:k,elevator:k,conditioner:k};b.addEventListener("change",(t=>{const r=t.target.tagName;if("SELECT"===r){const e=t.target.name.split("-")[1];x[e]=t.target.value}else if("INPUT"===r){const e=t.target.value;x[e]=!!t.target.checked}const o=e.slice().filter((e=>{for(let t in x)if(!V[t](e,x[t],t))return!1;return!0}));var a,n;a=H,n=o,window.lastTimeout&&window.clearTimeout(window.lastTimeout),window.lastTimeout=window.setTimeout((()=>{a(n)}),500)}));const T=document.querySelector(".ad-form"),A=document.querySelector(".map__filters"),$="ad-form--disabled",z=()=>{s.reset(),q(),b.reset(),N()};T.classList.add($),Array.from(T.children).forEach((e=>{e.setAttribute("disabled","")})),A.classList.add($),Array.from(A.children).forEach((e=>{e.setAttribute("disabled","")}));const D=document.querySelector("#card").content.querySelector(".popup"),j={flat:"Квартира",bungalow:"Бунгало",house:"Дом",palace:"Дворец",hotel:"Отель"},F=document.querySelector("#map-canvas"),I=[],U={lat:35.68555,lng:139.75555},M=window.L.icon({iconUrl:"../img/main-pin.svg",iconSize:[52,52],iconAnchor:[26,52]}),R=window.L.icon({iconUrl:"../img/pin.svg",iconSize:[40,40],iconAnchor:[20,40]}),H=e=>{const t=e.slice(0,10);0!==I.length&&I.forEach((e=>{e.remove()})),t.forEach((e=>{const t=window.L.marker({lat:e.location.lat,lng:e.location.lng},{icon:R});t.addTo(O).bindPopup((e=>{const t=D.cloneNode(!0),r=t.querySelector(".popup__title"),o=t.querySelector(".popup__text--address"),a=t.querySelector(".popup__text--price"),n=t.querySelector(".popup__type"),s=t.querySelector(".popup__text--capacity"),i=t.querySelector(".popup__text--time"),c=t.querySelector(".popup__features"),l=t.querySelector(".popup__description"),d=t.querySelector(".popup__photos"),u=t.querySelector(".popup__avatar");return r.textContent=e.offer.title,o.textContent=e.offer.address,a.innerHTML=`${e.offer.price} <span>₽/ночь</span>`,n.textContent=j[e.offer.type],s.textContent=`${e.offer.rooms} комнат для ${e.offer.guests} гостей`,i.textContent=`Заезд после ${e.offer.checkin}, выезд до ${e.offer.checkout}`,((e,t)=>{t?(e.innerHTML="",t.forEach((t=>{const r=document.createElement("li");r.classList.add("popup__feature",`popup__feature--${t}`),e.appendChild(r)}))):e.remove()})(c,e.offer.features),l.textContent=e.offer.description,((e,t)=>{t?(e.innerHTML="",t.forEach((t=>{const r=document.createElement("img");r.src=t,r.width="45",r.height="40",r.alt="Фотография жилья",e.appendChild(r)}))):e.remove()})(d,e.offer.photos),u.src=e.author.avatar?e.author.avatar:"../img/avatars/default.png",t})(e)),I.push(t)}))},N=()=>{P.setLatLng(U),C(U)},O=window.L.map(F).on("load",(()=>{var t,r;T.classList.remove($),Array.from(T.children).forEach((e=>{e.removeAttribute("disabled","")})),t=e=>{H(e),A.classList.remove($),Array.from(A.children).forEach((e=>{e.removeAttribute("disabled","")}))},r=e=>(e=>{const t=document.createElement("DIV");t.textContent=e,t.style.position="fixed",t.style.zIndex=1e3,t.style.top=0,t.style.left=0,t.style.right=0,t.style.padding="5px",t.style.background="#f00",t.style.fontSize="16px",t.style.color="#fff",t.style.textAlign="center",document.body.appendChild(t),setTimeout((()=>{document.body.removeChild(t)}),5e3)})(e),fetch("https://23.javascript.pages.academy/keksobooking/data").then((e=>{if(e.ok)return e.json();throw Error(e.status)})).then((r=>{e=r.slice(),t(r)})).catch((e=>{r(`Ошибка загрузки данных. ${e}`)}))})).setView(U,13);window.L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(O);const P=window.L.marker(U,{draggable:!0,icon:M});P.addTo(O),N(),P.on("move",(()=>{const e=P.getLatLng().lat.toFixed(5),t=P.getLatLng().lng.toFixed(5);C({lat:e,lng:t})}))})();
//# sourceMappingURL=main.bundle.js.map